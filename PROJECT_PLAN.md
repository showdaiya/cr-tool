# クラロワダメージ計算ツール - プロジェクト完成計画

## 📋 プロジェクト概要

**目的**: クラッシュロワイヤルのダメージ計算ツールをサーバーレス環境（Vercel）にデプロイして公開する

**現状**: 2つのReactアプリ（Vite版・Next.js版）が混在している状態

**最終目標**: Next.js版アプリを洗練させ、Vercelにデプロイして一般公開

---

## 🎯 プロジェクトフェーズ

### Phase 1: プロジェクト整理とクリーンアップ ✅ 次のステップ
- [ ] 使用するアプリを決定（Next.js版を採用）
- [ ] Vite版アプリの扱いを決定（削除 or アーカイブ）
- [ ] ルートディレクトリの整理
- [ ] README.md の作成

### Phase 2: 開発環境とルール整備
- [ ] コーディング規約の策定
- [ ] ディレクトリ構造の最適化
- [ ] Git運用ルールの策定
- [ ] 開発用ドキュメント整備

### Phase 3: 機能整理とリファクタリング
- [ ] 機能一覧の作成
- [ ] コンポーネント設計の見直し
- [ ] コードリファクタリング計画
- [ ] テスト計画

### Phase 4: 機能実装と改善
- [ ] 必須機能の完成
- [ ] UI/UX改善
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング強化

### Phase 5: デプロイ準備
- [ ] 環境変数の設定
- [ ] ビルド最適化
- [ ] SEO対策
- [ ] OGP設定

### Phase 6: デプロイと公開
- [ ] Vercelへのデプロイ
- [ ] 動作確認
- [ ] ドキュメント完成
- [ ] 公開

---

## 📂 Phase 1: プロジェクト整理（詳細）

### 1.1 使用アプリの決定

**採用**: `cr-tool-react-next-app/` (Next.js版)
- 最新のコミット履歴
- Next.js 15 + React 19
- Vercelへのデプロイが容易
- App Routerで最新アーキテクチャ

**非採用**: `cr-tool-react-app/` (Vite版)
- 古い実装
- Next.js版に機能移行済み

### 1.2 ディレクトリ構造の整理

結論として、**Next.jsアプリを無理にルート直下へ移動する必要はありません**。
Vercel は "Root Directory" を指定できるため、現状のまま `cr-tool-react-next-app/` をデプロイ対象にする方が安全です。

**提案する最終構造（移動しない方針）**:
```
cr-tool/
├── .git/
├── .gitignore                  # ルート（monorepo向け）
├── README.md                   # プロジェクト全体の説明
├── PROJECT_PLAN.md             # この計画書
├── CODING_STANDARDS.md         # コーディング規約
├── CONTRIBUTING.md             # 開発ガイド
├── github-setup-commands.txt   # Git/GitHub設定履歴
├── docs/                       # ドキュメント（任意）
│   ├── FEATURES.md
│   ├── ARCHITECTURE.md
│   └── DEPLOYMENT.md
├── cr-tool-react-next-app/     # 本番採用（Vercel Root Directory = このフォルダ）
└── cr-tool-react-app/          # 旧実装（アーカイブ or 削除は後で判断）
```

### 1.3 実行タスク

- [x] プロジェクト計画書の作成（このファイル）
- [ ] ルートREADME.mdの作成（どのアプリが本番か明記）
- [ ] Vercel設定（Root Directory を `cr-tool-react-next-app/` に設定）
- [ ] Vite版アプリの扱いを決める（残す/アーカイブ/削除）

---

## 📜 Phase 2: 開発環境とルール整備（詳細）

### 2.1 コーディング規約（CODING_STANDARDS.md）

**必要な項目**:
1. TypeScript使用ルール
   - 型定義の書き方
   - any禁止ポリシー
   - インターフェース vs 型エイリアス

2. React/Next.jsベストプラクティス
   - コンポーネント命名規則
   - ファイル構成ルール
   - Hooksの使用ルール
   - Server/Client Componentの使い分け

3. スタイリング規約
   - Chakra UIの使用方針
   - カスタムCSSの扱い
   - レスポンシブ対応基準

4. 状態管理ルール
   - Context APIの使用方針
   - ローカルステートの範囲

5. エラーハンドリング
   - エラーバウンダリの配置
   - エラーメッセージの統一

6. コメント・ドキュメント
   - JSDocの使用
   - 関数説明の書き方

### 2.2 ディレクトリ構造規約

```
src/
├── app/              # Next.js App Router
│   ├── layout.tsx   # ルートレイアウト
│   ├── page.tsx     # トップページ
│   └── globals.css  # グローバルスタイル
├── components/       # UIコンポーネント
│   ├── features/    # 機能別コンポーネント
│   │   ├── attack/  # 攻撃カード関連
│   │   └── defense/ # 防衛カード関連
│   ├── ui/          # 汎用UIコンポーネント
│   └── layouts/     # レイアウトコンポーネント
├── context/         # Context API
│   ├── CardContext.tsx
│   └── ChakraProvider.tsx
├── data/            # 静的データ
│   └── CardData.json
├── hooks/           # カスタムフック
├── types/           # 型定義
├── utils/           # ユーティリティ関数
└── constants.ts     # 定数定義
```

### 2.3 Git運用ルール

**ブランチ戦略**:
- `main`: 本番環境（常にデプロイ可能）
- `develop`: 開発ブランチ（統合）
- `feature/*`: 機能開発
- `fix/*`: バグ修正
- `refactor/*`: リファクタリング

**コミットメッセージ規約**:
```
<type>: <subject>

<body>

<footer>
```

タイプ:
- `feat`: 新機能
- `fix`: バグ修正
- `refactor`: リファクタリング
- `docs`: ドキュメント
- `style`: コードスタイル
- `perf`: パフォーマンス改善
- `test`: テスト
- `chore`: その他

例:
```
feat: 攻撃カードの削除機能を追加

攻撃カード一覧から個別に削除できるボタンを実装。
削除確認ダイアログも追加。

Closes #123
```

---

## 🎯 Phase 3: 機能整理とリファクタリング（詳細）

### 3.1 現在の機能一覧

**実装済み機能**:
1. ✅ 防衛カード選択
   - カードリストからの選択
   - HP/ダメージ表示
   - カード画像表示

2. ✅ 攻撃カード管理
   - 複数カードの追加
   - カード編集
   - カード削除
   - 攻撃回数設定
   - 複数ダメージタイプ対応

3. ✅ ダメージ計算
   - リアルタイム計算
   - 総ダメージ表示
   - 残りHP表示

4. ✅ UI機能
   - ダークモード対応
   - レスポンシブデザイン
   - スクロール追従通知
   - カードソート機能

5. ✅ パフォーマンス最適化
   - React.memoの活用
   - useMemoでの計算結果キャッシュ
   - レンダリング遅延ロジック

**未実装・改善が必要な機能**:
1. ❌ ユーザーデータの保存
   - ローカルストレージ対応（削除済み→再実装検討）
   - セッション保存

2. ❌ 計算履歴機能
   - 過去の計算結果保存
   - 履歴表示・再利用

3. ❌ エクスポート機能
   - 計算結果のスクリーンショット
   - URL共有機能

4. ❌ アクセシビリティ改善
   - キーボード操作の完全対応
   - スクリーンリーダー対応

5. ❌ エラーハンドリング強化
   - ユーザーフレンドリーなエラーメッセージ
   - オフライン対応

### 3.2 リファクタリング計画

**優先度: 高**
1. コンポーネント分割の見直し
   - `CardBattlePage`が大きすぎる可能性
   - 責任の明確化

2. 型定義の整理
   - `CardTypes.ts`の構造見直し
   - Utilityタイプの活用

3. 定数の集約
   - 分散している定数を`constants.ts`に集約
   - 環境変数の導入

**優先度: 中**
4. カスタムフックの拡充
   - ロジックの共通化
   - テスタビリティ向上

5. エラーバウンダリの配置見直し
   - 粒度の最適化

**優先度: 低**
6. CSS最適化
   - 未使用スタイルの削除
   - パフォーマンス改善

---

## 🚀 Phase 4: 機能実装と改善（詳細）

### 4.1 必須機能の完成

**タスクリスト**:
- [ ] カードデータの最新化
  - クラロワ最新カードの追加
  - 画像の確認・追加

- [ ] 計算ロジックの検証
  - テストケース作成
  - エッジケースの確認

- [ ] UI/UXの最終調整
  - デザインの統一
  - 操作フローの改善

### 4.2 UI/UX改善項目

1. **レスポンシブ対応強化**
   - モバイル表示の最適化
   - タブレット表示の調整

2. **操作性向上**
   - ドラッグ&ドロップ対応
   - キーボードショートカット

3. **視覚的フィードバック**
   - ローディング状態の明示
   - 操作完了アニメーション

### 4.3 パフォーマンス最適化

- [ ] Next.js Image最適化
- [ ] コード分割の最適化
- [ ] バンドルサイズ削減
- [ ] Lighthouse スコア90以上

---

## 🌐 Phase 5: デプロイ準備（詳細）

### 5.1 Vercel設定

**必要な設定**:
1. プロジェクトルートの設定
2. ビルドコマンドの確認
3. 環境変数の設定（必要に応じて）
4. カスタムドメイン設定（オプション）

### 5.2 SEO対策

**meta.tsの設定**:
```typescript
export const metadata = {
  title: 'クラロワダメージ計算ツール',
  description: 'クラッシュロワイヤルのカードダメージを計算できるツール',
  openGraph: {
    title: 'クラロワダメージ計算ツール',
    description: 'クラッシュロワイヤルのカードダメージを計算',
    images: ['/og-image.png'],
  },
}
```

### 5.3 OGP画像作成

- [ ] OGP画像のデザイン
- [ ] 画像ファイルの配置（1200x630px推奨）

### 5.4 最終チェックリスト

- [ ] ビルドエラーなし
- [ ] 型エラーなし
- [ ] ESLintエラーなし
- [ ] 全機能動作確認
- [ ] モバイル動作確認
- [ ] パフォーマンステスト

---

## 📊 Phase 6: デプロイと公開

### 6.1 Vercelデプロイ手順

```bash
# Vercel CLIインストール（初回のみ）
npm install -g vercel

# デプロイ
cd cr-tool
vercel

# 本番デプロイ
vercel --prod
```

### 6.2 公開後のタスク

- [ ] 動作確認（本番環境）
- [ ] パフォーマンス測定
- [ ] バグ報告の受付準備
- [ ] README更新（デプロイURL追加）
- [ ] GitHubリポジトリのAbout更新

---

## 📝 開発時の注意事項

### コミット前チェックリスト
- [ ] `npm run lint` でエラーなし
- [ ] `npm run build` が成功
- [ ] 型エラーなし（`tsc --noEmit`）
- [ ] 変更内容を適切にコミットメッセージに記載

### コードレビュー観点
1. 型安全性
2. パフォーマンス
3. 可読性
4. 再利用性
5. アクセシビリティ

---

## 🎓 参考資料

### 技術ドキュメント
- [Next.js公式](https://nextjs.org/docs)
- [React公式](https://react.dev/)
- [Chakra UI](https://chakra-ui.com/)
- [TypeScript](https://www.typescriptlang.org/)

### デプロイ
- [Vercel公式](https://vercel.com/docs)

---

## 📅 スケジュール（目安）

| Phase | 作業内容 | 期間目安 |
|-------|---------|---------|
| 1 | プロジェクト整理 | 1-2日 |
| 2 | 開発環境整備 | 1日 |
| 3 | 機能整理・リファクタ | 3-5日 |
| 4 | 機能実装・改善 | 5-7日 |
| 5 | デプロイ準備 | 1-2日 |
| 6 | デプロイ・公開 | 1日 |
| **合計** | | **12-18日** |

---

## ✅ 次のアクション（Phase 1開始）

1. [ ] この計画書をレビュー・確認
2. [ ] Phase 1のタスクを実行開始
3. [ ] コーディング規約の策定
4. [ ] 機能一覧の詳細化

---

**作成日**: 2025-12-21  
**最終更新**: 2025-12-21  
**ステータス**: Phase 1 準備中
